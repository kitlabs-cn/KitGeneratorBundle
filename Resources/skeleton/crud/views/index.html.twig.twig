{% block extends %}
{{ "{% extends 'layout.html.twig' %}" }}
{% endblock extends %}

{{ "{% block css %}" }}
<link rel="stylesheet" href="{{ "{{ asset('css/research.css?v=1024'|theme) }}" }}">
{{ "{% endblock %}" }}

{% block body %}
{{ "{% block content %}" }}
		{{ '{{' }}
			config_search([
				{% for field, metadata in fields -%}
					{%- if loop.index < 4 -%}
						{% if metadata.options.comment is defined -%}
							config_search_getFieldHtml('{{ metadata.options.comment }}', '{{ field }}'),
						{% else -%}
							config_search_getFieldHtml('{{ field|capitalize }}', '{{ field }}'),
						{% endif %}
					{%- endif %}
				{%- endfor %}

			], [
				{{ 'session_menu_access(\'' ~ route_name_prefix ~ '_new\')' }} ? '<a class="button notice_add" href="{{ '\'~ path(\'' ~ route_name_prefix ~'_new\') ~ \'' }}"><span class="icon-plus"></span>新增</a>' : '',
			])
		{{ '}}' }}
		<div class="list_box">
			<table class="table listTable">
				<tr>
					{% for field, metadata in fields -%}
						<th>
							{%- if metadata.options.comment is defined -%}
								{{ metadata.options.comment }}
							{%- else -%}
								{{ field|capitalize }}
							{%- endif -%}
						</th>
					{% endfor -%}
					<th class="last-child">操作</th>
				</tr>
				{{'{% if pagination is defined and pagination is not empty %}' }}
				{{ '{% for item in pagination %}' }}
				{% set isSetTitle = false -%}
				<tr id="item_{{ '{{ item.id }}' }}">
					{% for field, metadata in fields -%}
						<td>
							{%- if isSetTitle == false and metadata.type == 'string' -%}
								{%- set isSetTitle = true -%}
                                {{ '{% if session_menu_access(\'' ~ route_name_prefix ~ '_show\') %}' }}
								<a class="notice_tit" href="{{ '{{ path(\'' ~ route_name_prefix ~'_show\', { \'id\': item.id }) }}' }}" >{{ '{{ item.' ~ field ~ '|truncate(20,false,\'...\') }}' }}</a>
								{{ '{% else %}' }}
								{{ '{{ item.' ~ field ~ '|truncate(20,false,\'...\') }}' }}
								{{ '{% endif %}' }}
							{%- else -%}
								{%- if metadata.type in ['datetime'] -%}
									{{ '{{ item.' ~ field ~ '|date(\'Y-m-d H:i:s\') }}' }}
								{%- elseif metadata.type in ['string', 'text'] -%}
									{{ '{{ item.' ~ field ~ '|truncate(20,false,\'...\') }}' }}
								{%- else -%}
									{{- '{{ item.' ~ field ~ ' }}' -}}
								{%- endif -%}
							{%- endif -%}
						</td>
					{% endfor -%}
					<td class="operation_btn">
						<div class="relative">
							<a class="text-yellow hover_span">...</a>
							<ul class="operate_complete">
							    {{ '{% if session_menu_access(\'' ~ route_name_prefix ~ '_show\') %}' }}
								<li><a class="text-blue" href="{{ '{{ path(\'' ~ route_name_prefix ~'_show\', { \'id\': item.id }) }}' }}">查看</a></li>
                                {{ '{% endif %}' }}
								{{ '{% if session_menu_access(\'' ~ route_name_prefix ~ '_edit\') %}' }}
								<li><a class="text-yellow" href="{{ '{{ path(\'' ~ route_name_prefix ~'_edit\', { \'id\': item.id }) }}' }}">编辑</a></li>
								{{ '{% endif %}' }}

								{{ '{% if session_menu_access(\'' ~ route_name_prefix ~ '_delete\') %}' }}
								<li><a class="text-red" href="javascript:void(0)" onclick="delItem({{ '{{' }} item.id {{ '}}' }})">删除</a></li>
								{{ '{% endif %}' }}
							</ul>
						</div>
					</td>
				</tr>
				{{ '{% endfor %}' }}
				{{ '{% else %}' }}
					{% set num = (fields|length) -%}
					{{ '{{ macro_no_content('~ (num+1) ~') }}' }}
				{{ '{% endif %}' }}
			</table>
			{{ '{{ knp_pagination_render(pagination,\'pagination.html.twig\') }}' }}
		</div>
{{ "{% endblock %}" }}
{{ '{% block js %}' }}
<script>

   /**
	* 删除单个实体
	*/
	function delItem($id)
	{
		layer.confirm('确定要删除吗?', {}, function (_layer_index) {
			layer.close(_layer_index); // 关闭提示层
			var _loading_index = layer.load(1, {shade: [0.1, '#fff']}); // 加载动画

			$.post(
					"{{ '{{ path(\'' ~ route_name_prefix ~ '_delete\') }}' }}", {id: $id },
					function (result) {
						layer.close(_loading_index); // 关闭加载动画
						if (result.code == 1) {
							layer.msg(result.msg, {icon: 1,time: 2000}, function () {
								PopupPage.closePopup();
								window.location.reload()
							});
						} else {
							layer.msg(result.msg, {icon: 2,time: 2000});
						}
					}
			).error(function () {
				layer.close(_loading_index); // 关闭加载动画
				layer.msg('服务异常', {icon: 2, time: 2000});
			});
		})
	}
</script>
{{ '{% endblock %}' }}
{% endblock body %}
